// SDF_Shape_Vesica.osl by IMAN SHIRANI
// 2025-11-25



shader SDF_Shape_Vesica
(
    point Position = P,
    
    float Radius = 0.5 [[ string label = "Radius (r)" ]],
    float Spread = 0.2 [[ string label = "Spread (d)" ]],
    
    output float SDF_Out = 0.0
)
{
    
    point p = Position;
    
    
    p = abs(p);
    float b = sqrt(Radius*Radius - Spread*Spread);
    
    float d = 0.0;
    if ((p[1]-b)*Spread > p[0]*b) {
        d = length(vector(p[0], p[1]-b, 0)) - 0.0; 
        
    } else {
        d = length(vector(p[0], p[1], 0) - vector(-Spread, 0, 0)) - Radius;
    }
    
    
    vector p_abs = vector(abs(p[0]), abs(p[1]), 0.0);
    float r = Radius;
    float d_val = Spread;
    
    float b_val = sqrt(r*r - d_val*d_val);
    
    
    float cond = (p_abs[1]-b_val)*d_val > p_abs[0]*b_val ? 1.0 : 0.0;
    
    vector v1 = vector(p_abs[0], p_abs[1]-b_val, 0.0);
    vector v2 = vector(p_abs[0]+d_val, p_abs[1], 0.0);
    
    SDF_Out = (cond > 0.5) ? length(v1) : length(v2) - r;
}